@baseUrl = http://localhost:8087/api/v1
@email = user@example.com
@password = User@123

# ==============================================================================
# 1. LOGIN (REQUIRED FIRST)
# Use this to get the Access Token.
# ==============================================================================
# @name login
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{email}}",
  "password": "{{password}}"
}

###
# VARIABLE CAPTURE
# This automatically grabs the token from the response above
@authToken = {{login.response.body.data.accessToken}}


# ==============================================================================
# 2. CREATE BOOKING (Deep Nested Write)
# This tests the Transactional creation of Booking -> Itinerary -> Activities
# ==============================================================================
# @name createBooking
POST {{baseUrl}}/bookings
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "destination": "El Nido, Palawan",
  "startDate": "2024-05-20T00:00:00.000Z",
  "endDate": "2024-05-23T00:00:00.000Z",
  "travelers": 2,
  "totalPrice": 25000.00,
  "type": "CUSTOMIZED",
  "tourType": "PRIVATE",
  "itinerary": [
    {
      "dayNumber": 1,
      "date": "2024-05-20T00:00:00.000Z",
      "activities": [
        { "time": "08:00 AM", "title": "Airport Pickup", "order": 1, "icon": "Van" },
        { "time": "10:00 AM", "title": "Hotel Check-in", "order": 2, "icon": "Hotel" },
        { "time": "04:00 PM", "title": "Sunset Beach Walk", "order": 3, "icon": "Sun" }
      ]
    },
    {
      "dayNumber": 2,
      "date": "2024-05-21T00:00:00.000Z",
      "activities": [
        { "time": "09:00 AM", "title": "Island Hopping Tour A", "description": "Big Lagoon, Secret Lagoon", "order": 1, "icon": "Boat" },
        { "time": "12:00 PM", "title": "Lunch Buffet", "order": 2, "icon": "Utensils" }
      ]
    }
  ]
}

###
# VARIABLE CAPTURE
# Grabs the new Booking ID for subsequent tests
@bookingId = {{createBooking.response.body.data.id}}


# ==============================================================================
# 3. GET ONE BOOKING (Full Details)
# Should return the booking along with nested itinerary and activities
# ==============================================================================
GET {{baseUrl}}/bookings/{{bookingId}}
Authorization: Bearer {{authToken}}

###
# ==============================================================================
# 4. UPDATE ITINERARY (Nuke and Rebuild)
# Warning: This replaces the entire itinerary for this booking.
# Notice Day 2 is removed and Day 1 activities are different.
# ==============================================================================
PUT {{baseUrl}}/bookings/{{bookingId}}
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "destination": "Coron, Palawan (UPDATED)",
  "startDate": "2024-06-01T00:00:00.000Z",
  "endDate": "2024-06-03T00:00:00.000Z",
  "travelers": 4,
  "totalPrice": 45000.00,
  "itinerary": [
    {
      "dayNumber": 1,
      "date": "2024-06-01T00:00:00.000Z",
      "activities": [
        { "time": "07:00 AM", "title": "Super Ultimate Tour", "description": "Kayangan Lake, Twin Lagoon", "order": 1, "icon": "Boat" },
        { "time": "06:00 PM", "title": "Seafood Dinner", "order": 2, "icon": "Fish" }
      ]
    }
  ]
}

###
# ==============================================================================
# 5. ADMIN: REJECT BOOKING
# Requires 'rejectionReason' and 'rejectionResolution'
# Note: Ensure the user logged in above has ROLE = ADMIN, or this will fail with 403
# ==============================================================================
PATCH {{baseUrl}}/bookings/{{bookingId}}/status
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "status": "REJECTED",
  "rejectionReason": "Dates are fully booked",
  "rejectionResolution": "Please choose dates after June 5th"
}

###
# ==============================================================================
# 6. ADMIN: APPROVE BOOKING
# ==============================================================================
PATCH {{baseUrl}}/bookings/{{bookingId}}/status
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "status": "CONFIRMED"
}

###
# ==============================================================================
# 7. GET MY BOOKINGS (Paginated)
# ==============================================================================
GET http://localhost:8087/api/v1/bookings/my-bookings?page=1&limit=5
Authorization: Bearer {{authToken}}
