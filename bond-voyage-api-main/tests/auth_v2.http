### ========================================
### BondVoyage Authentication API Tests
### ========================================

### Variables
@baseUrl = http://localhost:8087/api/v1
@prodUrl = https://bond-voyage-api.onrender.com/api/v1
@accessToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJmYTY3NDg0YS0yNWVkLTQxNDEtOWQ3YS03ODRhMTI1ODNlZmUiLCJlbWFpbCI6ImZlbGl4YW5nZWxvbWVsZ2FyNUBnbWFpbC5jb20iLCJwaG9uZU51bWJlciI6IjA5NjEyMTMzNTIwIiwicm9sZSI6IlVTRVIiLCJpYXQiOjE3NjYxNjI0MTYsImV4cCI6MTc2NjE2MzI1Nn0.79bpd_UNhTexZqAZjCg1ekBe-ijk1wkSMNKPQY36Hz0
@adminEmail = senyahmelchi124@gmail.com
@adminPassword = Admin@123
@userEmail = felixangelomelgar5@gmail.com
@userPassword = User@123

### ========================================
### 1. REGISTER NEW ADMIN
### ========================================
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "firstName": "Melchizedek",
  "middleName": "",
  "lastName": "Haynes",
  "email": "{{adminEmail}}",
  "phoneNumber": "09612133521",
  "password": "Admin@123",
  "role": "ADMIN",
  "birthday": "2004-05-05"
}

### ========================================
### 2. REGISTER NEW USER
### ========================================
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "firstName": "Felix",
  "lastName": "Melgar",
  "email": "{{userEmail}}",
  "phoneNumber": "09612133520",
  "password": "User@123",
  "role": "USER",
  "birthday": "2004-05-05"
}

### ========================================
### 3. LOGIN AS ADMIN (Success)
### ========================================
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}

### Expected Response Structure:
# {
#   "success": true,
#   "message": "Login successful",
#   "data": {
#     "accessToken": "eyJhbGc...",
#     "user": {
#       "firstName": "John",
#       "lastName": "Doe",
#       "email": "admin@bondvoyage.com",
#       "phone": "+1234567890",
#       "location": "New York, USA",
#       "companyName": "BondVoyage Inc.",
#       "yearsInOperation": "5",
#       "customerRating": "4.85"
#     }
#   }
# }

### ========================================
### 4. LOGIN AS USER (Success)
### ========================================
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{userEmail}}",
  "password": "{{userPassword}}"
}

### Expected Response Structure:
# {
#   "success": true,
#   "message": "Login successful",
#   "data": {
#     "accessToken": "eyJhbGc...",
#     "user": {
#       "firstName": "Jane",
#       "lastName": "Smith",
#       "email": "user@bondvoyage.com",
#       "phone": "+0987654321",
#       "address": "123 Main St, Los Angeles, CA 90001"
#     }
#   }
# }

### ========================================
### 5. LOGIN - Invalid Credentials
### ========================================
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "wrong@email.com",
  "password": "wrongpassword"
}

### Expected: 401 Unauthorized

### ========================================
### 6. LOGIN - Missing Password
### ========================================
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}"
}

### Expected: 400 Bad Request

### ========================================
### 7. LOGIN - Missing Email
### ========================================
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "password": "{{adminPassword}}"
}

### Expected: 400 Bad Request

### ========================================
### 8. LOGIN - Empty Request Body
### ========================================
POST {{baseUrl}}/auth/login
Content-Type: application/json

{}

### Expected: 400 Bad Request

### ========================================
### 9. REFRESH TOKEN
### ========================================
### Note: Must have refreshToken cookie from previous login
POST {{baseUrl}}/auth/refresh-token
Content-Type: application/json

### ========================================
### 10. GET PROFILE (Protected Route)
### ========================================
### Replace YOUR_ACCESS_TOKEN with actual token from login
GET {{baseUrl}}/auth/profile
Authorization: Bearer {{accessToken}}

### ========================================
### 11. LOGOUT (Single Device)
### ========================================
### Replace YOUR_ACCESS_TOKEN with actual token from login
POST {{baseUrl}}/auth/logout
Authorization: Bearer {{accessToken}}

### ========================================
### 12. LOGOUT ALL (All Devices)
### ========================================
### Replace YOUR_ACCESS_TOKEN with actual token from login
## POST {{prodUrl}}/auth/logout-all
## Authorization: Bearer YOUR_ACCESS_TOKEN

### ========================================
### 13. SEND OTP (Password Reset Step 1)
### ========================================
POST {{baseUrl}}/auth/send-otp
Content-Type: application/json

{
  "email": "felixangelomelgar5@gmail.com",
  "firstName": "Felix"
}

### ========================================
### 14. VERIFY OTP (Password Reset Step 2)
### ========================================
### Replace 123456 with actual OTP from email
POST {{baseUrl}}/auth/verify-otp
Content-Type: application/json

{
  "email": "{{userEmail}}",
  "otp": "235947"
}

### ========================================
### 15. RESET PASSWORD (Password Reset Step 3)
### ========================================
### Must be called within 5 minutes of OTP verification
POST {{baseUrl}}/auth/reset-password
Content-Type: application/json

{
  "email": "felixangelomelgar5@gmail.com",
  "newPassword": "User@123"
}

### ========================================
### PRODUCTION TESTS (Change baseUrl to prodUrl)
### ========================================

### Admin Login (Production)
# POST {{prodUrl}}/auth/login
# Content-Type: application/json
#
# {
#   "email": "{{adminEmail}}",
#   "password": "{{adminPassword}}"
# }

### ========================================
### NOTES
### ========================================
# 1. refreshToken is stored as httpOnly cookie automatically
# 2. Copy accessToken from login response and use in Authorization header
# 3. Password reset requires 3 steps: send OTP → verify OTP → reset password
# 4. Admin response includes: location, companyName, yearsInOperation, customerRating
# 5. User response includes: address
# 6. All passwords are hashed with bcrypt before storage

### Get All Users (Requires Admin Token)
GET https://bond-voyage-api.onrender.com/api/v1/users
Content-Type: application/json
Authorization: Bearer {{accessToken}}